const data = {
  "ICT": {
    "Level-I": {
      "Semester-I": {
        "Essential of ICT and Computer Hardware": 1112,
        "Introduction to Multimedia Technologies": 1122,
        "Fundamentals of Computer Programming": 1132,
        "Programming Practicum": 1142,
        "Web Technologies": 1153,
        "Fundamentals of Information Systems": 1161,
        "Foundation of Mathematics": 1113,
      },
      "Semester-II": {
        "Database Management Systems": 1212,
        "Database Management Systems Practicum": 1222,
        "Server-Side Web Development": 1233,
        "Computer Architecture": 1242,
        "Computer Networks": 1253,
        "Discrete Mathematics": 1233,
        "Fundamentals of Management": 1212,
      },
    },
    "Level-II": {
      "Semester-I": {
        "Data Structures and Algorithms": 2113,
        "Object Oriented Programming": 2122,
        "Object Oriented Programming Practicum": 2132,
        "Software Engineering": 2142,
        "E-Commerce Implementation, Management and Security": 2152,
        "Business Economics": 2112,
        "Soft Skills": 2121,
        "English III": 2132,
      },
      "Semester-II": {
        "Operating System Concepts & Applications": 2213,
        "Internet Of Things": 2223,
        "Object Oriented Analysis & Design": 2232,
        "Management Information System": 2242,
        "Wireless Communications": 2252,
        "Probality and Statistics": 2212,
        "English IV": 2222,
        "Accounting for Technologists": 2212,
      },
    },
    "Level-III": {
      "Semester-I": {
        "Advanced Programming": 3112,
        "Advanced Programming Practicum": 3122,
        "IT Project Management": 3133,
        "Software Testing Methods and Tools": 3142,
        "Human Computer Interacion": 3152,
        "Rapid and Agile Software Development": 3162,
        "Business Analysis Essentials": 3171,
        "Group Project": 3183,
        "English V": 3122,
        "Human Resources Management": 3111,
      },
      "Semester-II": {
        "Advanced Database Management Systems": 3212,
        "Advanced Database Management Systems Practicum": 3222,
        "Data Science and Analysis": 3233,
        "Mobile Application Development": 3243,
        "Software Verification and Quality Assurance": 3252,
        "Digital Image Processing": 3263,
        "Scienific Writing and Research Methodologies": 3212,
      },
    },
    "Level-IV": {
      "Semester-I": {
        "Research project*": 4010,
        "Emerging Trends in IT": 4122,
        "Arificial Intelligence": 4133,
        "Proffesional Issues in IT": 4142,
        "Network, Computer and Application Security": 4153,
        "Disributed Systems and Cloud Computing": 4163,
        "Creativiy, Innovation and Entrepreneurship": 4112,
      },
      "Semester-II": {
        "Industrial Training": 4225,
        "Research project(Coninued)": 4216,
      },
    },
  },
  "ET": {
    "Level-I": {
      "Semester-I": {
        "Workshop Technology I": 1111,
        "Foundaion for Technology": 1121,
        "Foundation of Mathematics": 1113,
        "Chemistry of Materials": 1122,
        "Computer Fundamentals and PC Applications": 1132,
        "Physics of Mechanical Systems": 1143,
        "Applied Calculus I": 1152,
        "Common Practical I (Mechanical systems)": 1161,
        "English I": 1114,
      },
      "Semester-II": {
        "Workshop Technology II": 1211,
        "Common Practical II (Eletricity and Magnetism)": 1221,
        "Common Practical II (Engineering properies of matter)": 1231,
        "Electriciy and Magnetism": 1242,
        "Engineering Properties of Matter": 1253,
        "Applied Calculus II": 1213,
        "Computer Programming Techniques": 1223,
        "English II": 1212,
        "Fundamentals of Management": 1222,
      },
    },
    "Level-II": {
      "Semester-I": {
        "Analogue Electronic Systems": 2113,
        "Electronic Laboratory I": 2121,
        "Renewable and Alternative Energy Technology": 2132,
        "Object Oriented Programming": 2142,
        "Properties of Materials and Applications": 2152,
        "Basic Environmental Science": 2112,
        "English III": 2112,
        "Soft Skills": 2122,
        "Business Economics": 2132,
      },
      "Semester-II": {
        "Digital Electronic Systems": 2213,
        "Electronic Laboratory II": 2221,
        "Instrumentation and Caliberation": 2232,
        "Basic Automobile Technology": 2242,
        "Common Practical IV (Introducion to Robotics Laboratory)": 2251,
        "Technical Drawing and Computer Aided Drafting": 2262,
        "Probability and Statistics": 2213,
        "English IV": 2212,
        "Accounting for Technologists": 2222,
      },
    },
    "Level-III": {
      "Semester-I": {
        "Electrical Power Systems": 3112,
        "Electrical/Electronic and Mechanical Equipment Maintenance": 3122,
        "Computer Hardware and Network Maintenance": 3132,
        "Circuit Analysis and Fault Diagnosis": 3142,
        "Introduction to Robotics": 3152,
        "Workshop Technology III": 3161,
        "Welding Techniques": 3172,
        "Safety and Risk Management": 3111,
        "Ethics for Technologies": 3121,
        "English V": 3112,
      },
      "Semester-II": {
        "Industrial Training": 3216,
      },
    },
    "Level-IV": {
      "Semester-I": {
        "Mechatronics": 4113,
        "Electronic System Design": 4123,
        "Mechanics of Machines": 4132,
        "Machine Design": 4142,
        "Bio Medical Equipment*": 4152,
        "Polymer Materials*": 4162,
        "Creativiy, Innovation and Entrepreneurship": 4112,
        "Human Resources Management": 4121,
        "Operations Management for Technologies": 4132,
      },
      "Semester-II": {
        "Programmable Digital Electronics": 4212,
        "Power Electronics and Applications": 4223,
        "Fluid Dynamics and Machinery": 4232,
        "Nanotechnology": 4243,
        "Refrigeration and Air Conditioning": 4252,
        "Research and Design project": 4068,
      },
    },
  },
  "BST": {
    "Level-I": {
      "Semester-I": {
        "Information Technology I": 1112,
        "Foundation of Mathematics": 1113,
        "General Biology": 1132,
        "Plant Physiology": 1142,
        "Animal Physiology": 1152,
        "Introduction to Environmental Science": 1162,
        "Analytical Chemistry": 1172,
        "Thermodynamics": 1181,
        "English I": 1114,
      },
      "Semester-II": {
        "Information Technology II": 1212,
        "Electronics for Biosystems Technology": 1222,
        "Oraganic Chemistry": 1232,
        "Basic Biochemistry": 1242,
        "Fundamental Genetics": 1251,
        "Basic Microbiology": 1262,
        "Introduction to Fisheries Biology": 1272,
        "Fundamentals in Agriculture": 1282,
        "English II": 1222,
        "Fundamentals of Management": 1212,
      },
    },
    "Level-II": {
      "Semester-I": {
        "Application of Biosystems Technology": 2112,
        "Engineering Properties of Biomaterials": 2123,
        "Enzyme Technology": 2132,
        "Bioenergy Systems": 2142,
        "Bio-seperation Processes": 2152,
        "Biomechanics": 2162,
        "Business Economics": 2112,
        "Soft Skills": 2122,
        "English III": 2122,
      },
      "Semester-II": {
        "Conservation Technologies": 2212,
        "Geoinfomatics and Biosystems": 2222,
        "Indigenous Knowledge in Biosystems management": 2232,
        "Nanotechnology": 2242,
        "Gene Technology": 2253,
        "Statistical applications in biosystems technology": 2262,
        "Probability and Statistics": 2213,
        "English IV": 2222,
        "Accounting for Technologists": 2212,
      },
    },
    "Level-III": {
      "Semester-I": {
        "Environmental Monitoring and Waste Management": 3113,
        "Tissue Culture Technology": 3123,
        "Industrial Microbiology": 3133,
        "Biomedical Technology": 3142,
        "English V": 3122,
        "Safety and Risk Management": 3111,
        "Ethics for Technologies": 3121,
        "Art of Tradition": 3131,
      },
      "Semester-II": {
        "Industrial Training": 3216,
      },
    },
    "Level-IV": {
      "Food, Fisheries and Agriculture Technology Stream": {
        "Semester-I": {
          "Technological Perspectives of Food Processing and Packaging": 4113,
          "Food Analysis and Quality Assurance": 4122,
          "Fish Production Systems": 4132,
          "Fisheries Technology": 4142,
          "Horticulture Technology": 4152,
          "Nursery Management Technology": 4162,
          "Communication for Technologies": 4111,
          "Creavity, Innovation and Entrepreneurship": 4122,
          "Industrial Sociology": 4131,
        },
        "Semester-II": {
          "Crop and Livestock Production Systems": 4214,
          "Pest Controlling Technology": 4222,
          "Postharvest Technology": 4231,
          "Design Project/Research project": 4276,
          "Human Resource Management": 4211,
          "Operational Management for Technologist": 4222,
          "Acticve Citizenship": 4232,
        },
      },
      "Natural Products and Environmental Technology Stream": {
        "Semester-I": {
          "Soil Conservation and Land Management": 4112,
          "Soil Water and Drainage Management Technology": 4122,
          "Landscape Design and Construction": 4133,
          "Built Environment Design": 4142,
          "Field Methods in Hydrology": 4152,
          "Ecotourism Management": 4162,
          "Communication for Technologies": 4111,
          "Creavity, Innovation and Entrepreneurship": 4122,
          "Industrial Sociology": 4131,
        },
        "Semester-II": {
          "Water Technology": 4212,
          "Forest Resource and Wood Science": 4222,
          "Natural Products Development Technology": 4232,
          "Weather Forecasting Technology": 4242,
          "Design Project/Research project": 4276,
          "Human Resource Management": 4211,
          "Operational Management for Technologist": 4222,
          "Acticve Citizenship": 4232,
        },
      },
    },
  },
};

// grade values
const gradeVals = {
  "A+": 4.0,
  "A": 4.0,
  "A-": 3.7,
  "B+": 3.3,
  "B": 3.0,
  "B-": 2.7,
  "C+": 2.3,
  "C": 2.0,
};

// GPA Calculator
const dep = document.getElementById("department");
const level = document.getElementById("level");
const semester = document.getElementById("semester");
const subjects = document.querySelectorAll(".subChecked");
const grade = document.getElementById("grade");
const calcBtn = document.getElementById("calc-btn");
const subjectList = document.querySelector(".subject-list");
const gpaWrapper = document.querySelector(".gpa-wrapper");
const gpalabel = document.getElementById("gpa");
const selectAll = document.getElementById("selectAll");
const sem = document.getElementById("sem");
const popupContainer = document.querySelector(".popup-container");

// loading all subjects to subject selection
function loadSubjects() {
  genMajorsBST();
  restoreGPALabel();
  generateSubEntries();
}

// round off to the nearest decimal place
function round(value, decimals) {
  return Number(Math.round(value + "e" + decimals) + "e-" + decimals);
}

// generating majors section for BST
function genMajorsBST(){
  const stream_wrapper = document.getElementById("stream-wrapper");
  if (!stream_wrapper) {
    if (dep.value == "BST" && level.value == "Level-IV") {
      const ele = `
    <div id="stream-wrapper" class="inp_container grid gap-3 mb-4">
        <label class="text-xl" for="stream">Technology Stream</label>
        <select
          class="bg-red-100 p-3.5 rounded-md"
          name="stream"
          id="stream"
          onchange="loadSubjects()"
        >
          <option value="Food, Fisheries and Agriculture Technology Stream">Food, Fisheries and Agriculture</option>
          <option value="Natural Products and Environmental Technology Stream">Natural Products and Environmental</option>
        </select>
      </div>
  `;
      sem.insertAdjacentHTML("beforebegin", ele);
      generateSubEntries();
    }
  } else {
    if (dep.value != "BST" || level.value != "Level-IV") {
      stream_wrapper.remove();
    }
  }
}

// Generating the subject entries for gpa calculation
function generateSubEntries() {
  deleteAllSubEntries();
  let subjects;
  if (document.getElementById("stream-wrapper")) {
    const stream = document.getElementById("stream");
    subjects =
      data[`${dep.value}`][`${level.value}`][`${stream.value}`][
        `${semester.value}`
      ];
  } else {
    subjects = data[`${dep.value}`][`${level.value}`][`${semester.value}`];
  }
  for (const sub in subjects) {
    generateSubEntry(sub, subjects[sub]);
  }
}

// uncheck select all box
function selectAllUncheck() {
  selectAll.checked = false;
}

// Generate Subject Entry
function generateSubEntry(e, v) {
  const entry = `
            <div class="subject grid grid-cols-4 md:grid-cols-6 items-center gap-3 mb-4">
              <p class="sub col-span-2 md:col-span-4 ">${e}</p>     
              <input data-attr="${v}" onchange="selectAllUncheck()" type="checkbox" name="subChecked" id="" class="subChecked mx-auto md:mx-0 col-span-1">   
              <select class="block bg-red-100 p-1.5 col-span-1 rounded-md" name="grade" id="grade">
                  <option value="A+">A+</option>
                  <option value="A">A</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B">B</option>
                  <option value="B-">B-</option>
                  <option value="C+">C+</option>
                  <option value="C">C</option>
              </select>
            </div>
        `;
  subjectList.insertAdjacentHTML("beforeEnd", entry);
}

// Returns index of the subject
function returnIndex(sub) {
  subjectList.childNodes.forEach((ele, i) => {
    if (ele == sub) {
      return index;
    }
  });
}

// Delete all subject entries
function deleteAllSubEntries(e) {
  while (subjectList.hasChildNodes()) {
    subjectList.removeChild(subjectList.lastChild);
  }
}

// Select all subject entries
selectAll.addEventListener("change", (e) => {
  const subjecstInput = subjectList.children;
  if (!e.checked) {
    for (let i = 0; i < subjecstInput.length; i++) {
      let creditCheckbox = subjecstInput[i].querySelector(".subChecked");
      if (!creditCheckbox.checked) {
        creditCheckbox.checked = true;
      }
    }
  }
});

// Select all subject entries
selectAll.addEventListener("change", (e) => {
  const subjecstInput = subjectList.children;
  if (!e.checked) {
    for (let i = 0; i < subjecstInput.length; i++) {
      let creditCheckbox = subjecstInput[i].querySelector(".subChecked");
      if (!creditCheckbox.checked) {
        creditCheckbox.checked = true;
      }
    }
  }
});

// Calculate Total GPA
function calcTotalGPA() {
  let totalPoints = 0;
  let totalCredits = 0;
  const subjecstInput = subjectList.children;
  for (let i = 0; i < subjecstInput.length; i++) {
    let creditCheckbox = subjecstInput[i].querySelector(".subChecked");
    let gradeDropDown = subjecstInput[i].querySelector("#grade");
    if (creditCheckbox.checked) {
      let credit = creditCheckbox.dataset.attr;
      let grade = gradeDropDown.value;
      totalCredits += parseFloat(credit[credit.length - 1]);
      totalPoints += round(
        parseFloat(credit[credit.length - 1]) * parseFloat(gradeVals[grade]),
        2
      );
    }
  }
  let gpa = round(totalPoints / totalCredits, 2);
  if (!isNaN(gpa)) {
    gpalabel.textContent = `Total GPA : ${gpa}`;
  } else {
    gpalabel.className += " text-red-600";
    gpalabel.textContent = "No Subjects Selected";
    setTimeout(restoreGPALabel, 2000);
  }
}

// restore GPA Label
function restoreGPALabel() {
  gpalabel.className = "font-bold text-xl";
  gpalabel.textContent = "Total GPA : ";
}

calcBtn.addEventListener("click", calcTotalGPA);
loadSubjects();
